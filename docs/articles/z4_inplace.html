<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4 - In-place, copy, and target operations • Rvision</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4 - In-place, copy, and target operations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Rvision</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/z1_install.html">1 - Installing Rvision</a></li>
    <li><a class="dropdown-item" href="../articles/z2_io.html">2 - Input/output operations</a></li>
    <li><a class="dropdown-item" href="../articles/z3_basic.html">3 - Basic operations</a></li>
    <li><a class="dropdown-item" href="../articles/z4_inplace.html">4 - In-place, copy, and target operations</a></li>
    <li><a class="dropdown-item" href="../articles/z5_gpu.html">5 - GPU operations</a></li>
    <li><a class="dropdown-item" href="../articles/z6_queue.html">6 - Capture queues</a></li>
    <li><a class="dropdown-item" href="../articles/z7_stack.html">7 - Video stacks</a></li>
    <li><a class="dropdown-item" href="../articles/z8_calib.html">8 - Camera calibration</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/swarm-lab/Rvision/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>4 - In-place, copy, and target operations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/swarm-lab/Rvision/blob/HEAD/vignettes/z4_inplace.Rmd" class="external-link"><code>vignettes/z4_inplace.Rmd</code></a></small>
      <div class="d-none name"><code>z4_inplace.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="better-performances-with-in-place-operations">4.1 - Better performances with in-place operations<a class="anchor" aria-label="anchor" href="#better-performances-with-in-place-operations"></a>
</h2>
<p>While other image processing libraries for <code>R</code> are fast
enough for most operations on single images and often offer more options
than <code>Rvision</code> (but we are working on closing the gap on that
front), <code>Rvision</code> really shines in the high-speed processing
of large volumes of images (e.g. video and camera streams).</p>
<p>Part of the reason is that <a href="https://opencv.org/" class="external-link"><code>OpenCV</code></a> - the computer vision
library on top of which <code>Rvision</code> is built - is designed and
optimized for in-place operations, that is operations that change
directly the content of an object in memory without making a copy of it.
Indeed, making copies of objects in memory - especially of large ones
like images - can add a significant amount of time to an operation. For
that reason, most of <code>Rvision</code>’s functions offer the option
to perform their operations in-place, greatly increasing the processing
speed of large volumes of images.</p>
<p>All operations that support in-place operations will have an argument
named “target” that can be set to the value “self”. For instance:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the path to the balloon1.png image provided with Rvision</span></span>
<span><span class="va">path_to_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sample_img"</span>, <span class="st">"balloon1.png"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the image in memory</span></span>
<span><span class="va">my_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Image-class.html">image</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="va">path_to_image</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the original image</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply a Gaussian blur in place. Note that the operation will not return </span></span>
<span><span class="co"># anything and the result will replace the content of my_image.</span></span>
<span><span class="fu"><a href="../reference/gaussianBlur.html">gaussianBlur</a></span><span class="op">(</span><span class="va">my_image</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">3</span>, <span class="fl">3</span>, target <span class="op">=</span> <span class="st">"self"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot original image after modification</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="preserving-originals-with-copy-operations">4.2 - Preserving originals with copy operations<a class="anchor" aria-label="anchor" href="#preserving-originals-with-copy-operations"></a>
</h2>
<p>The downside of in-place operations is that the modification is
destructive: the original object in memory is replaced bit for bit by
its modified version (we are just talking about the RAM representation
of the object here; the original file on your drive is never modified
directly).</p>
<p>However, it may be desirable in some cases to keep the original
object in memory untouched. For this purpose, all the functions in
<code>Rvision</code> that can modify images also give users the option
to perform their operations on a copy of the original image. This will
be slower but resemble the usual behavior of <code>R</code>
functions.</p>
<p>By default, all operations are copy operations but this can be
explicitly specified by setting the “target” argument to “new”. For
instance:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the path to the balloon1.png image provided with Rvision</span></span>
<span><span class="va">path_to_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sample_img"</span>, <span class="st">"balloon1.png"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the image in memory</span></span>
<span><span class="va">my_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Image-class.html">image</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="va">path_to_image</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply a Gaussian blur to a copy of the image. </span></span>
<span><span class="va">my_blurred_copy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gaussianBlur.html">gaussianBlur</a></span><span class="op">(</span><span class="va">my_image</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">3</span>, <span class="fl">3</span>, target <span class="op">=</span> <span class="st">"new"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot original image</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot blurred copy </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_blurred_copy</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="the-best-of-both-worlds-target-operations">4.3 - The best of both worlds: target operations<a class="anchor" aria-label="anchor" href="#the-best-of-both-worlds-target-operations"></a>
</h2>
<p>But what if I want to preserve the original object AND be fast at the
same time?</p>
<p>Then you are in luck. <code>Rvision</code> - still thanks to
<code>OpenCV</code> - also offers “target” operations, that is
operations which results can be stored in another image in memory (the
target) as long as that image was pre-allocated before the operation
takes place and that it has the same memory footprint as the original
image. This is as fast as in-place operations but it does not modify the
original image; instead, it modifies a separate image that serves as a
placeholder for the results.</p>
<p>All operations that support target operations will have an argument
named “target” that can be set to the name of the target image. For
instance:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the path to the balloon1.png image provided with Rvision</span></span>
<span><span class="va">path_to_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sample_img"</span>, <span class="st">"balloon1.png"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the image in memory</span></span>
<span><span class="va">my_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Image-class.html">image</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="va">path_to_image</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a zero-filled target image with the memory footprint of the original</span></span>
<span><span class="va">my_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zeros.html">zeros</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>, <span class="fu"><a href="../reference/nrow.Rcpp_Image.html">nchan</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span>, <span class="fu"><a href="../reference/bitdepth.html">bitdepth</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply a Gaussian blur to the original image but store the results in the </span></span>
<span><span class="co"># target. Note that the operation will not return anything and the result will </span></span>
<span><span class="co"># replace the content of my_target.</span></span>
<span><span class="fu"><a href="../reference/gaussianBlur.html">gaussianBlur</a></span><span class="op">(</span><span class="va">my_image</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">3</span>, <span class="fl">3</span>, target <span class="op">=</span> <span class="va">my_target</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot original image</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_image</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot target</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_target</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="when-to-use-in-place-copy-and-target-operations">4.4 - When to use in-place, copy, and target operations?<a class="anchor" aria-label="anchor" href="#when-to-use-in-place-copy-and-target-operations"></a>
</h2>
<p>If you are going to process a single image (or a small batch of
images) with only one or a few simple operations, then copy operations
are probably the best choice. They will be fast enough (a fraction of a
second at most) and more familiar to <code>R</code> users since they
essentially mimic the behavior of traditional <code>R</code> functions
by always returning a new object. They are also very useful when
troubleshooting your pipeline since every step will be saved in a
separate object and can therefore be inspected individually for
problems.</p>
<p>If you are going to process a large number of images (typically, when
processing a video or camera stream) and you only care about preserving
the final result of the pipeline, then in-place operations will be the
best choice. They will provide the best performance both in terms of
speed and overall memory footprint.</p>
<p>Finally, if you are going to process a large number of images but
need to preserve the original image or the result of an intermediary
step in your pipeline (e.g. in order to reuse it later in your
pipeline), then target operations should be preferred.</p>
<p>Note that the different operation types are not mutually exclusive
and can be used together in the same processing pipeline for increased
flexibility.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.theswarmlab.com" class="external-link">Simon Garnier</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
