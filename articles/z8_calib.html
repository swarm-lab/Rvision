<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Rvision">
<title>8 - Camera calibration • Rvision</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="8 - Camera calibration">
<meta property="og:description" content="Rvision">
<meta property="og:image" content="https://swarm-lab.github.io/Rvision/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Rvision</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/z1_install.html">1 - Installing Rvision</a>
    <a class="dropdown-item" href="../articles/z2_io.html">2 - Input/output operations</a>
    <a class="dropdown-item" href="../articles/z3_basic.html">3 - Basic operations</a>
    <a class="dropdown-item" href="../articles/z4_inplace.html">4 - In-place, copy, and target operations</a>
    <a class="dropdown-item" href="../articles/z5_gpu.html">5 - GPU operations</a>
    <a class="dropdown-item" href="../articles/z6_queue.html">6 - Capture queues</a>
    <a class="dropdown-item" href="../articles/z7_stack.html">7 - Video stacks</a>
    <a class="dropdown-item" href="../articles/z8_calib.html">8 - Camera calibration</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/swarm-lab/Rvision/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>8 - Camera calibration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/swarm-lab/Rvision/blob/HEAD/vignettes/z8_calib.Rmd" class="external-link"><code>vignettes/z8_calib.Rmd</code></a></small>
      <div class="d-none name"><code>z8_calib.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="camera-calibration">8.1 - Camera calibration<a class="anchor" aria-label="anchor" href="#camera-calibration"></a>
</h2>
<p>Starting with <code>Rvision</code> 0.7.1, users can perform basic
camera calibration steps to correct lens distortion. This can be
particularly useful when working with cameras that have a wide field of
view (e.g., GoPro cameras) and when performing photogrammetry.</p>
<p>In this vignette, we will briefly describe the calibration process
and provide an example of how to calibrate a camera using
<code>Rvision</code>.</p>
<hr>
</div>
<div class="section level2">
<h2 id="calibration-process">8.2 - Calibration process<a class="anchor" aria-label="anchor" href="#calibration-process"></a>
</h2>
<div class="section level3">
<h3 id="calibration-pattern">8.2.1 - Calibration pattern<a class="anchor" aria-label="anchor" href="#calibration-pattern"></a>
</h3>
<p>The calibration process is relatively straightforward. First, the
user must capture a series of images of a calibration target. The
calibration target should be a planar surface with a regular pattern of
points (at the time of writing, <code>Rvision</code> only supports a
checkerboard pattern). You can find a sample calibration target provided
with the <code>Rvision</code> package at the following location in your
hard drive:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sample_img/checkerboard6x9.png"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span></span></code></pre></div>
<p>You can print this image and use it as a calibration target, or you
can create your own as long as it represents a checkerboard pattern.</p>
<p>Once the target is ready, you should take a series of images of it
using the camera that you want to calibrate. The target should be placed
at different distances from the camera and at different angles. The
target should also be rotated about the camera’s optical axis. An
example video of a calibration target being used to calibrate a webcam
is provided with the <code>Rvision</code> package at the following
location in your hard drive:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sample_vid/calibration.mp4"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span></span></code></pre></div>
<p>We will use this video to demonstrate the calibration process.</p>
</div>
<div class="section level3">
<h3 id="calibration-steps">8.2.2 - Calibration steps<a class="anchor" aria-label="anchor" href="#calibration-steps"></a>
</h3>
<div class="section level4">
<h4 id="setting-the-calibration-pattern-parameters">8.2.2.1 - Setting the calibration pattern parameters<a class="anchor" aria-label="anchor" href="#setting-the-calibration-pattern-parameters"></a>
</h4>
<p>The first step in the calibration process is to set the calibration
pattern parameters. These parameters are used to detect the calibration
pattern in the images and provide a correspondence between the
calibration pattern points and their image coordinates.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Checkerboard inner dimensions, i.e., the number of inner corners formed by the</span></span>
<span><span class="co"># checkerboard pattern. In this case, the checkerboard has 7x10 squares and, </span></span>
<span><span class="co"># therefore, 6x9 inner corners.</span></span>
<span><span class="va">cdims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Size of a checkerboard square in mm. </span></span>
<span><span class="va">ssize</span> <span class="op">&lt;-</span> <span class="fl">22.71</span></span>
<span></span>
<span><span class="co"># Checkerboard real-world relative coordinates. The first point is the origin </span></span>
<span><span class="co"># and the remaining points are the coordinates of the remaining inner corners.</span></span>
<span><span class="co"># Since the checkerboard is planar, the z-coordinate is always 0.</span></span>
<span><span class="va">checkerboard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">cdims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">cdims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    z <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">*</span> <span class="va">ssize</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="detecting-the-calibration-pattern">8.2.2.2 - Detecting the calibration pattern<a class="anchor" aria-label="anchor" href="#detecting-the-calibration-pattern"></a>
</h4>
<p>The next step is to detect the calibration pattern in the video
frame. The script below illustrates how to do this with the example
video provided with the <code>Rvision</code> package. The different
steps are described in the comments. This process might not work for
your video depending on lighting and image quality, so you might have to
tweak the parameters. This process can also take a long time and you
might want to skip some frames to speed it up. A good rule of thumb is
to select frames that (1) show the calibration pattern clearly and (2)
show it at different angles and distances from the camera.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Lists to store reference and image coordinates.</span></span>
<span><span class="va">ref_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">img_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Location of the calibration video.</span></span>
<span><span class="va">vid_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sample_vid/calibration.mp4"</span>, package <span class="op">=</span> <span class="st">"Rvision"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load video and create temporary storage frames.</span></span>
<span><span class="va">vid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Video-class.html">video</a></span><span class="op">(</span><span class="va">vid_file</span><span class="op">)</span></span>
<span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zeros.html">zeros</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">gray</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zeros.html">zeros</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">bw3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zeros.html">zeros</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Skip the first 25 frames that do not show the calibration pattern.</span></span>
<span><span class="fu"><a href="../reference/frame.html">frame</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">26</span></span>
<span></span>
<span><span class="co"># Loop through the video frames.</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">26</span><span class="op">:</span><span class="fu"><a href="../reference/video_dimensions.html">nframes</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Read the next frame.</span></span>
<span>  <span class="fu"><a href="../reference/readNext.html">readNext</a></span><span class="op">(</span><span class="va">vid</span>, <span class="va">fr</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Threshold the frame. This is done by converting each pixel above the average</span></span>
<span>  <span class="co"># pixel intensity to white and the remaining pixels to black. This is done to</span></span>
<span>  <span class="co"># remove noise and to make the calibration pattern stand out. This is a very</span></span>
<span>  <span class="co"># simple thresholding method and might not work for your video.</span></span>
<span>  <span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span><span class="va">fr</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fr</span><span class="op">)</span><span class="op">)</span>, <span class="st">"&gt;"</span>, <span class="va">bw3</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Find the calibration pattern corners. This is done using the function</span></span>
<span>  <span class="co"># called `findChessboardCorners`. The first argument is the image to be</span></span>
<span>  <span class="co"># analyzed. The second and third arguments are the inner dimensions of the</span></span>
<span>  <span class="co"># checkerboard pattern. The fourth argument is a logical value indicating</span></span>
<span>  <span class="co"># whether adaptive thresholding should be used. This can be useful to improve</span></span>
<span>  <span class="co"># the detection of the calibration pattern in images with uneven lighting. </span></span>
<span>  <span class="co"># However, it can significantly increase the processing time. We will not use</span></span>
<span>  <span class="co"># it in this example. The function returns a matrix with the coordinates of</span></span>
<span>  <span class="co"># the corners. If the function is able to find all the corners, the number of</span></span>
<span>  <span class="co"># rows in the matrix will be equal to the product of the inner dimensions.</span></span>
<span>  <span class="va">corners</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findChessboardCorners.html">findChessboardCorners</a></span><span class="op">(</span><span class="va">bw3</span>, <span class="va">cdims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">cdims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># If the function was able to find all the corners...</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">corners</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">cdims</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Convert the frame to grayscale.</span></span>
<span>    <span class="fu"><a href="../reference/changeColorSpace.html">changeColorSpace</a></span><span class="op">(</span><span class="va">fr</span>, <span class="st">"GRAY"</span>, <span class="va">gray</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Refine the corner coordinates. This is done using the function called</span></span>
<span>    <span class="co"># `cornerSubPix`. The first argument is the grayscale image. The second</span></span>
<span>    <span class="co"># argument is the matrix with the corner coordinates. The function returns a</span></span>
<span>    <span class="co"># matrix with the refined corner coordinates.</span></span>
<span>    <span class="va">corners</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cornerSubPix.html">cornerSubPix</a></span><span class="op">(</span><span class="va">gray</span>, <span class="va">corners</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Store the reference and image coordinates. </span></span>
<span>    <span class="va">ref_points</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ref_points</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">checkerboard</span></span>
<span>    <span class="va">img_points</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">img_points</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">corners</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>You can visualize the coverage of the calibration pattern in the
video frames as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">img_points</span><span class="op">)</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  xlab <span class="op">=</span> <span class="cn">NA</span>, ylab <span class="op">=</span> <span class="cn">NA</span>, main <span class="op">=</span> <span class="st">"Calibration pattern coverage"</span>,</span>
<span>  cex.main <span class="op">=</span> <span class="fl">2</span>, cex.axis <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span></span>
<span>  v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span><span class="op">)</span>, h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"gray"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/z8_coverage.png" width="100%"></p>
<p>In this particular example, the coverage is not perfect, but it is
good enough for our demonstration purposes.</p>
</div>
<div class="section level4">
<h4 id="compute-the-camera-parameters">8.2.2.3 - Compute the camera parameters<a class="anchor" aria-label="anchor" href="#compute-the-camera-parameters"></a>
</h4>
<p>The next step is to compute the camera parameters. This is done using
the function called <code>calibrateCamera</code>. The first argument is
the list of reference coordinates. The second argument is the list of
image coordinates. The third and fourth arguments are the dimensions the
video frames. The last argument is the maximum number of iterations to
be used by the optimization algorithm. The function returns a list with
the camera parameters. This step can some time, so be patient.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calib</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrateCamera.html">calibrateCamera</a></span><span class="op">(</span><span class="va">ref_points</span>, <span class="va">img_points</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">vid</span><span class="op">)</span>, maxit <span class="op">=</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can now use the camera parameters to correct lens distortion in
the video. This is done using the function called
<code>undistort</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read a frame from the video. </span></span>
<span><span class="fu"><a href="../reference/readFrame.html">readFrame</a></span><span class="op">(</span><span class="va">vid</span>, <span class="fl">250</span>, <span class="va">fr</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a frame to store the undistorted image.</span></span>
<span><span class="va">fr_undist</span> <span class="op">&lt;-</span> <span class="va">fr</span> <span class="op">*</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Correct lens distortion.</span></span>
<span><span class="fu"><a href="../reference/undistort.html">undistort</a></span><span class="op">(</span><span class="va">fr</span>, <span class="va">calib</span><span class="op">$</span><span class="va">camera_matrix</span>, <span class="va">calib</span><span class="op">$</span><span class="va">dist_coeffs</span>, target <span class="op">=</span> <span class="va">fr_undist</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the original and undistorted images on top of each other.</span></span>
<span><span class="va">conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/concatenate.html">concatenate</a></span><span class="op">(</span><span class="fu"><a href="../reference/border.html">border</a></span><span class="op">(</span><span class="va">fr</span>, <span class="fl">0</span>, <span class="fl">25</span>, <span class="fl">0</span>, <span class="fl">0</span>, border_color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>, <span class="va">fr_undist</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">conc</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/z8_comparison.png" width="100%"></p>
<p>Notice how the barrel distortion visible in the original image (top)
is corrected in the undistorted image (bottom).</p>
<p>You can now save the camera parameters to a file for future use. We
recommend using the <code>list.save</code> function from the
<code>rlist</code> package to do this. You can later use the
<code>list.load</code> function from the same package to load the camera
parameters from the saved file.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://renkun-ken.github.io/rlist/" class="external-link">rlist</a></span><span class="op">)</span></span>
<span><span class="fu">list.save</span><span class="op">(</span><span class="va">calib</span>, <span class="st">"calib.json"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.theswarmlab.com" class="external-link">Simon Garnier</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
